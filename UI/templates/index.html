<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>教学大纲与教案生成</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif; background: #f6f7fb; margin: 0; }
    .container { min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 24px; }
    .card { width: 100%; max-width: 760px; background: #fff; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); padding: 28px; }
    h1 { margin: 0 0 16px; font-size: 22px; color: #111827; text-align: center; }
    p.desc { margin: 0 0 24px; color: #6b7280; font-size: 14px; text-align: center; }
    .form-group { margin-bottom: 16px; }
    label { display: block; margin-bottom: 8px; font-size: 14px; color: #374151; }
    input[type="text"], input[type="number"], input[type="password"], select { width: 100%; padding: 10px 12px; border: 1px solid #e5e7eb; border-radius: 10px; background: #fff; font-size: 14px; color: #111827; }
    textarea { width: 100%; padding: 10px 12px; border: 1px solid #e5e7eb; border-radius: 10px; background: #fff; font-size: 14px; color: #111827; min-height: 160px; resize: vertical; }
    input::placeholder, textarea::placeholder { color: #9ca3af; }
    .hint { font-size: 12px; color: #9ca3af; margin-top: 6px; }
    .actions { margin-top: 24px; display: flex; gap: 12px; }
    button { flex: 1; padding: 10px 14px; background: #2563eb; color: #fff; border: none; border-radius: 10px; cursor: pointer; font-size: 14px; transition: background 0.2s ease; }
    button:hover { background: #1e40af; }
    .msg { margin-bottom: 12px; padding: 10px 12px; border-radius: 8px; font-size: 13px; }
    .msg.error { background: #fee2e2; color: #991b1b; border: 1px solid #fecaca; }
    /* 新增：授课信息面板样式 */
    .panel { margin: 16px 0; padding: 16px; border: 1px solid #e5e7eb; border-radius: 12px; background: #f9fafb; }
    .panel h2 { margin: 0 0 12px; font-size: 16px; color: #111827; }
    .panel-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    @media (max-width: 640px) { .panel-grid { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>教学大纲与教案生成</h1>
      <p class="desc">填写信息并提交，系统将生成 Markdown 大纲与 JSON 教案，存入 output 目录。</p>

      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          {% for category, message in messages %}
            <div class="msg {{ category }}">{{ message }}</div>
          {% endfor %}
        {% endif %}
      {% endwith %}

      <form method="post" action="/">
        <div class="form-group">
          <label for="course">课程名称</label>
          <input type="text" id="course" name="course" placeholder="如：软件测试" required />
        </div>
        <div class="form-group">
          <label for="weeks">总周数</label>
          <input type="number" id="weeks" name="weeks" value="18" min="1" required />
          <div id="weeks-hint" class="hint" style="margin-top:6px;color:#666;font-size:13px;"></div>
        </div>
        <div class="form-group">
          <label for="exclude">排除项（可留空，逗号分隔）</label>
          <input type="text" id="exclude" name="exclude" placeholder="例如：ChatGPT、生成代码、过度理论化" />
        </div>
        <div class="form-group">
          <label for="features">教学大纲的功能说明（不排除项，可留空）</label>
          <textarea id="features" name="features" rows="8" placeholder="例如：强调项目驱动与企业真实场景；覆盖功能测试、接口测试、性能测试基础；强化用例设计与缺陷分析；包含至少2次综合实训与一次结课项目评审"></textarea>
        </div>
        
        <!-- 新增：授课信息面板 -->
        <div class="panel">
          <h2>授课信息</h2>
          <div class="panel-grid">
            <div class="form-group">
              <label for="teacher">授课老师</label>
              <input type="text" id="teacher" name="teacher" placeholder="如：张老师" />
            </div>
            <div class="form-group">
              <label for="class_name">授课班级</label>
              <input type="text" id="class_name" name="class_name" placeholder="如：计科21-1班" />
            </div>
            <div class="form-group">
              <label for="location">授课地点</label>
              <input type="text" id="location" name="location" placeholder="如：教学楼A-305" />
            </div>
            <div class="form-group">
              <label for="assessment">考核方式</label>
              <select id="assessment" name="assessment">
                <option value="考察" selected>考察</option>
                <option value="考试">考试</option>
              </select>
            </div>
            <div class="form-group">
              <label for="class_size">班级人数</label>
              <input type="number" id="class_size" name="class_size" min="1" max="99" step="1" inputmode="numeric" pattern="\\d*" placeholder="单位：人（1-99）" title="请输入 1-99 的整数" />
            </div>
            <div class="form-group">
              <label for="weekly_hours">周学时</label>
              <select id="weekly_hours" name="weekly_hours">
                <option value="4" selected>4 学时/周</option>
                <option value="2">2 学时/周</option>
              </select>
            </div>
            <div class="form-group">
              <label for="teaching_time">授课时间</label>
              <select id="teaching_time" name="teaching_time">
                <option value="1234节" selected>1234节</option>
                <option value="5678节">5678节</option>
                <option value="12节">12节</option>
                <option value="34节">34节</option>
                <option value="56节">56节</option>
                <option value="78节">78节</option>
              </select>
            </div>
          </div>
        </div>
        
        <div class="form-group">
          <label for="model">大模型选择</label>
          <select id="model" name="model">
            <option value="deepseek-chat" selected>DeepSeek - deepseek-chat</option>
            <option value="gpt-4o-mini">OpenAI - gpt-4o-mini</option>
          </select>
        </div>
        <div class="form-group">
          <label for="api_key">API Key</label>
          <input type="password" id="api_key" name="api_key" placeholder="粘贴你的模型 Key（不显示明码）" required />
        </div>
        <div class="actions">
          <button type="submit">生成文档</button>
        </div>
      </form>
    </div>
  </div>

  <script>
     function updateWeeksHint() {
       const weeksInput = document.getElementById('weeks');
       const hint = document.getElementById('weeks-hint');
       const v = parseInt(weeksInput.value, 10);
       if (!isNaN(v)) {
         if (v === 18) {
           hint.textContent = '建议 18 周，最后一周复习与综合提升';
         } else if (v === 20) {
           hint.textContent = '建议 最后一周复习与综合提升';
         } else {
           hint.textContent = '建议 最后一周安排复习与综合提升';
         }
       } else {
         hint.textContent = '';
       }
     }
     document.addEventListener('DOMContentLoaded', updateWeeksHint);
     document.getElementById('weeks').addEventListener('input', updateWeeksHint);

     // 新增：班级人数校验（只能为 1-99 的整数）
     document.addEventListener('DOMContentLoaded', function() {
       const form = document.querySelector('form');
       const classSize = document.getElementById('class_size');
       if (!form || !classSize) return;
       const validateClassSize = () => {
         const v = (classSize.value || '').trim();
         classSize.setCustomValidity('');
         if (v === '') return true; // 可选项，允许不填
         if (!/^\d+$/.test(v)) {
           classSize.setCustomValidity('班级人数只能为整数');
           return false;
         }
         const n = parseInt(v, 10);
         if (n < 1 || n >= 100) {
           classSize.setCustomValidity('班级人数须为 1-99 的整数');
           return false;
         }
         return true;
       };
       classSize.addEventListener('input', validateClassSize);
       form.addEventListener('submit', function(e) {
         if (!validateClassSize() || !form.checkValidity()) {
           e.preventDefault();
           classSize.reportValidity();
         }
       });
     });
  </script>
</body>
</html>